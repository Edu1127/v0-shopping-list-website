{"version":3,"sources":["../../../../lib/shopping-lists.ts"],"sourcesContent":["import { supabase } from './supabase'\r\n\r\nexport type ShoppingList = {\r\n  id: string\r\n  user_id: string\r\n  name: string\r\n  description: string | null\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\nexport type ShoppingListItem = {\r\n  id: string\r\n  list_id: string\r\n  name: string\r\n  quantity: number\r\n  completed: boolean\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\n// Shopping Lists Operations\r\nexport async function getShoppingLists(userId: string) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_lists')\r\n      .select('*')\r\n      .eq('user_id', userId)\r\n      .order('updated_at', { ascending: false })\r\n\r\n    if (error) throw error\r\n\r\n    return { lists: data as ShoppingList[], error: null }\r\n  } catch (error) {\r\n    return { lists: [], error }\r\n  }\r\n}\r\n\r\nexport async function createShoppingList(userId: string, name: string, description?: string) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_lists')\r\n      .insert([\r\n        {\r\n          user_id: userId,\r\n          name,\r\n          description: description || null,\r\n        },\r\n      ])\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw error\r\n\r\n    return { list: data as ShoppingList, error: null }\r\n  } catch (error) {\r\n    return { list: null, error }\r\n  }\r\n}\r\n\r\nexport async function updateShoppingList(listId: string, updates: Partial<ShoppingList>) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_lists')\r\n      .update({\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq('id', listId)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw error\r\n\r\n    return { list: data as ShoppingList, error: null }\r\n  } catch (error) {\r\n    return { list: null, error }\r\n  }\r\n}\r\n\r\nexport async function deleteShoppingList(listId: string) {\r\n  try {\r\n    const { error } = await supabase.from('shopping_lists').delete().eq('id', listId)\r\n\r\n    if (error) throw error\r\n\r\n    return { error: null }\r\n  } catch (error) {\r\n    return { error }\r\n  }\r\n}\r\n\r\n// Shopping List Items Operations\r\nexport async function getShoppingListItems(listId: string) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_list_items')\r\n      .select('*')\r\n      .eq('list_id', listId)\r\n      .order('created_at', { ascending: true })\r\n\r\n    if (error) throw error\r\n\r\n    return { items: data as ShoppingListItem[], error: null }\r\n  } catch (error) {\r\n    return { items: [], error }\r\n  }\r\n}\r\n\r\nexport async function addShoppingListItem(listId: string, name: string, quantity: number = 1) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_list_items')\r\n      .insert([\r\n        {\r\n          list_id: listId,\r\n          name,\r\n          quantity,\r\n        },\r\n      ])\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw error\r\n\r\n    return { item: data as ShoppingListItem, error: null }\r\n  } catch (error) {\r\n    return { item: null, error }\r\n  }\r\n}\r\n\r\nexport async function updateShoppingListItem(itemId: string, updates: Partial<ShoppingListItem>) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_list_items')\r\n      .update({\r\n        ...updates,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq('id', itemId)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw error\r\n\r\n    return { item: data as ShoppingListItem, error: null }\r\n  } catch (error) {\r\n    return { item: null, error }\r\n  }\r\n}\r\n\r\nexport async function deleteShoppingListItem(itemId: string) {\r\n  try {\r\n    const { error } = await supabase.from('shopping_list_items').delete().eq('id', itemId)\r\n\r\n    if (error) throw error\r\n\r\n    return { error: null }\r\n  } catch (error) {\r\n    return { error }\r\n  }\r\n}\r\n\r\n// Realtime Subscriptions\r\nexport function subscribeToShoppingListItems(\r\n  listId: string,\r\n  callback: (items: ShoppingListItem[]) => void\r\n) {\r\n  const channel = supabase\r\n    .channel(`items-${listId}`)\r\n    .on(\r\n      'postgres_changes',\r\n      {\r\n        event: '*',\r\n        schema: 'public',\r\n        table: 'shopping_list_items',\r\n        filter: `list_id=eq.${listId}`,\r\n      },\r\n      async (payload) => {\r\n        // Add a small delay to ensure database is updated\r\n        await new Promise(resolve => setTimeout(resolve, 100))\r\n        // Fetch updated items when there's a change\r\n        const { items } = await getShoppingListItems(listId)\r\n        callback(items)\r\n      }\r\n    )\r\n    .subscribe()\r\n\r\n  // Return unsubscribe function\r\n  return () => {\r\n    supabase.removeChannel(channel)\r\n  }\r\n}\r\n\r\nexport function subscribeToShoppingLists(\r\n  userId: string,\r\n  callback: (lists: ShoppingList[]) => void\r\n) {\r\n  const channel = supabase\r\n    .channel(`lists-${userId}`)\r\n    .on(\r\n      'postgres_changes',\r\n      {\r\n        event: '*',\r\n        schema: 'public',\r\n        table: 'shopping_lists',\r\n        filter: `user_id=eq.${userId}`,\r\n      },\r\n      async (payload) => {\r\n        // Add a small delay to ensure database is updated\r\n        await new Promise(resolve => setTimeout(resolve, 100))\r\n        // Fetch updated lists when there's a change\r\n        const { lists } = await getShoppingLists(userId)\r\n        callback(lists)\r\n      }\r\n    )\r\n    .subscribe()\r\n\r\n  // Return unsubscribe function\r\n  return () => {\r\n    supabase.removeChannel(channel)\r\n  }\r\n}\r\n\r\nexport async function toggleShoppingListItem(itemId: string, completed: boolean) {\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('shopping_list_items')\r\n      .update({\r\n        completed,\r\n        updated_at: new Date().toISOString(),\r\n      })\r\n      .eq('id', itemId)\r\n      .select()\r\n      .single()\r\n\r\n    if (error) throw error\r\n\r\n    return { item: data as ShoppingListItem, error: null }\r\n  } catch (error) {\r\n    return { item: null, error }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}